"use strict";angular.module("moviabusApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angularMoment","angular-momentjs"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("moviabusApp").filter("checkType",["$moment",function(a){return function(b,c){var d=[];if(b){var e=new Date;e=Date.parse(e);for(var f=0;f<b.length;f++){var g,h,i,j,k,l;if(b[f].transportType===c){switch(b[f].transportType){case"BUS":if(l=b[f].lineDesignation,k=l.length,g=l.slice(l.length-1),j=new RegExp(/[0-9]/gi),j.test(g)===!0)g="yellow-bus";else switch(g){case"S":g="s-bus";break;case"A":g="a-bus";break;case"E":g="e-bus"}b[f].lineType=g,h=b[f].expectedDepartureDateTime,i=a(h).fromNow(!0),i=parseInt(i.split(" ")),b[f].timeLeft=j.test(i)===!0?i:0;break;case"S-TOG":g=b[f].lineDesignation.toLowerCase()+"-tog",b[f].lineType=g,h=b[f].expectedDepartureDateTime,i=a(h).fromNow(!0),j=new RegExp(/[0-9]/gi),i=parseInt(i.split(" ")),b[f].timeLeft=j.test(i)===!0?i:0;break;case"METRO":g=b[f].lineDesignation.slice(b[f].lineDesignation.length-2),b[f].lineDesignation=g,b[f].lineType=g,h=b[f].expectedDepartureDateTime,i=a(h).fromNow(!0),j=new RegExp(/[0-9]/gi),i=parseInt(i.split(" ")),b[f].timeLeft=j.test(i)===!0?i:0;break;case"TOG":l=b[f].lineDesignation,k=l.split(" "),g=k[0],b[f].lineDesignation=g,b[f].lineType=g.toLowerCase(),h=b[f].expectedDepartureDateTime,i=a(h).fromNow(!0),j=new RegExp(/[0-9]/gi),i=parseInt(i.split(" ")),b[f].timeLeft=j.test(i)===!0?i:0}d.push(b[f])}}return d}}}]).factory("getTransport",function(){var a=!0,b=!0,c=!0,d=!0;return{toggleTransport:function(e){switch(e){case"BUS":a=!a,console.log(a);break;case"S-TOG":b=!b;break;case"METRO":c=!c;break;case"TOG":d=!d}},returnTransport:function(e){switch(e){case"BUS":return a;case"S-TOG":return b;case"METRO":return c;case"TOG":return d}}}}).factory("busNumber",function(){var a="8478";return{getBusNumber:function(){return console.log(a),a},setBusNumber:function(b){""!=b&&(a=b,console.log(a))}}}).controller("MainCtrl",["$scope","$interval","$timeout","getBus","getTransport","busNumber",function(a,b,c,d,e,f){a.bus=f.getBusNumber(),a.busInfo={},a.showBus=e.returnTransport("BUS"),a.showStog=e.returnTransport("S-TOG"),a.showMetro=e.returnTransport("METRO"),a.showTog=e.returnTransport("TOG"),a.newBus="",a.searchNew=function(){""!=a.newBus&&f.setBusNumber(a.newBus)},a.toggle=function(b){switch(e.toggleTransport(b),b){case"BUS":a.showBus=e.returnTransport("BUS");break;case"S-TOG":a.showStog=e.returnTransport("S-TOG");break;case"METRO":a.showMetro=e.returnTransport("METRO");break;case"TOG":a.showTog=e.returnTransport("TOG")}},a.computeTransportType=function(b,c){a.showBus=e.returnTransport("BUS"),a.showStog=e.returnTransport("S-TOG"),a.showMetro=e.returnTransport("METRO"),a.showTog=e.returnTransport("TOG");var d=0;if(b){for(var f=0;f<b.length;f++)b[f].transportType===c&&d++;switch(c){case"BUS":return 0===d?!1:a.showBus===!0?!0:!1;case"S-TOG":return 0===d?!1:a.showStog===!0?!0:!1;case"METRO":return 0===d?!1:a.showMetro===!0?!0:!1;case"TOG":return 0===d?!1:a.showTog===!0?!0:!1}}},a.negTime=function(a){return 0>a?(console.log(a),!0):!1},b(function(){var b=f.getBusNumber();a.getOneBus=d.getBusInfo(b).then(function(b){200===b.status?a.busInfo=b.data:console.log("Error occured"+b.status)})},5e3)}]),angular.module("moviabusApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("moviabusApp").factory("getBus",["$http",function(a){return{getBusInfo:function(b){var c=a.get("https://wsilb.moviatrafik.dk/infotainment/v2/vehicle/"+b);return c}}}]);